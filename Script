local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")
local plr = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- إعدادات الألوان الأصلية (Red & Dark)
local AccentRed = Color3.fromRGB(255, 0, 0)
local MainPurple = Color3.fromRGB(150, 0, 0) -- مستعمل هنا كـ Dark Red
local BGColor = Color3.fromRGB(10, 0, 0)

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "TOGA_ULTIMATE_V4"
ScreenGui.Parent = CoreGui
ScreenGui.ResetOnSpawn = false

-- [ الزر العائم ] --
local OpenBtn = Instance.new("TextButton", ScreenGui)
OpenBtn.Size = UDim2.new(0, 50, 0, 50)
OpenBtn.Position = UDim2.new(1, -70, 1, -70)
OpenBtn.BackgroundColor3 = BGColor
OpenBtn.Text = "</>"
OpenBtn.TextColor3 = AccentRed
OpenBtn.Font = Enum.Font.Code
OpenBtn.TextSize = 18
OpenBtn.ZIndex = 10
Instance.new("UICorner", OpenBtn).CornerRadius = UDim.new(1, 0)

local IconStroke = Instance.new("UIStroke", OpenBtn)
IconStroke.Color = AccentRed
IconStroke.Thickness = 1.5

-- [ المينو الرئيسي ] --
local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.BackgroundColor3 = BGColor
MainFrame.BackgroundTransparency = 0.1
MainFrame.Position = UDim2.new(1, 400, 1, -280)
MainFrame.Size = UDim2.new(0, 320, 0, 260) -- زدنا شوية فالحجم للزر الجديد
MainFrame.ClipsDescendants = false
MainFrame.Visible = false
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 15)

-- [ نظام البرق الأحمر ] --
local function CreateLightningBolt()
    if not MainFrame.Visible then return end
    local bolt = Instance.new("Frame", MainFrame)
    bolt.BackgroundColor3 = AccentRed
    bolt.BorderSizePixel = 0
    bolt.ZIndex = -1
    local side = math.random(1, 4)
    bolt.Position = (side==1 and UDim2.new(0,math.random(0,320),0,0)) or (side==2 and UDim2.new(0,math.random(0,320),1,0)) or (side==3 and UDim2.new(0,0,0,math.random(0,230))) or UDim2.new(1,0,0,math.random(0,230))
    bolt.Size = UDim2.new(0, math.random(2,4), 0, math.random(20,60))
    bolt.Rotation = math.random(0,360)
    TweenService:Create(bolt, TweenInfo.new(0.2), {BackgroundTransparency = 1, Size = bolt.Size + UDim2.new(0,2,0,40)}):Play()
    task.delay(0.2, function() bolt:Destroy() end)
end

task.spawn(function()
    while true do
        if MainFrame.Visible then CreateLightningBolt() end
        task.wait(math.random(0.1, 0.3))
    end
end)

-- [ تطوير النقط - Particles ] --
local ParticleContainer = Instance.new("Frame", MainFrame)
ParticleContainer.Size = UDim2.new(1, 0, 1, 0)
ParticleContainer.BackgroundTransparency = 1
for i = 1, 12 do
    local dot = Instance.new("Frame", ParticleContainer)
    dot.Size = UDim2.new(0, 6, 0, 6)
    dot.BackgroundColor3 = AccentRed
    dot.BackgroundTransparency = 0.4
    Instance.new("UICorner", dot).CornerRadius = UDim.new(1, 0)
    local function move()
        TweenService:Create(dot, TweenInfo.new(math.random(2, 5)), {Position = UDim2.new(math.random(), 0, math.random(), 0)}):Play()
    end
    dot.Position = UDim2.new(math.random(), 0, math.random(), 0)
    task.spawn(function() while true do move() task.wait(5) end end)
end

-- [ العنوان ] --
local Title = Instance.new("TextLabel", MainFrame)
Title.Text = "TOGA ULTIMATE"
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 22
Title.TextColor3 = AccentRed
Title.Size = UDim2.new(1, 0, 0, 40)
Title.BackgroundTransparency = 1

-- [ الوظائف ] --
local function toggleBtn(btn, stroke, state, name)
    btn.Text = name .. (state and " [ON]" or " [OFF]")
    btn.TextColor3 = state and Color3.fromRGB(0, 255, 0) or AccentRed
    stroke.Color = state and Color3.fromRGB(0, 255, 0) or MainPurple
end

local function createCmdBtn(name, pos, callback)
    local btn = Instance.new("TextButton", MainFrame)
    btn.Text = name .. " [OFF]"
    btn.Font = Enum.Font.Code
    btn.TextSize = 10
    btn.TextColor3 = AccentRed
    btn.BackgroundColor3 = Color3.fromRGB(15, 0, 0)
    btn.Size = UDim2.new(0, 130, 0, 26)
    btn.Position = pos
    local stroke = Instance.new("UIStroke", btn)
    stroke.Thickness = 1.2
    stroke.Color = MainPurple
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
    btn.MouseButton1Click:Connect(function() callback(btn, stroke) end)
    return btn, stroke
end

-- [ إضافة الأزرار ] --
createCmdBtn("LOCK PLAYERS", UDim2.new(0.05, 0, 0.20, 0), function(b, s) _G.masterLock = not _G.masterLock; toggleBtn(b, s, _G.masterLock, "LOCK PLAYERS") end)
createCmdBtn("LOCK NPCs", UDim2.new(0.05, 0, 0.33, 0), function(b, s) _G.npcLock = not _G.npcLock; toggleBtn(b, s, _G.npcLock, "LOCK NPCs") end)
createCmdBtn("ESP PLAYERS", UDim2.new(0.05, 0, 0.46, 0), function(b, s) _G.espPlayers = not _G.espPlayers; toggleBtn(b, s, _G.espPlayers, "ESP PLAYERS") end)
createCmdBtn("ESP NPCs", UDim2.new(0.05, 0, 0.59, 0), function(b, s) _G.espNpcs = not _G.espNpcs; toggleBtn(b, s, _G.espNpcs, "ESP NPCs") end)

createCmdBtn("WALK FLING", UDim2.new(0.53, 0, 0.20, 0), function(b, s) _G.flinging = not _G.flinging; toggleBtn(b, s, _G.flinging, "WALK FLING") end)
createCmdBtn("FLY (F1/F2)", UDim2.new(0.53, 0, 0.33, 0), function() end)
createCmdBtn("NOCLIP (F3/F4)", UDim2.new(0.53, 0, 0.46, 0), function() end)

-- [[[ زر FPS BOOST الجديد ]]] --
createCmdBtn("FPS BOOST", UDim2.new(0.53, 0, 0.59, 0), function(b, s)
    _G.fpsBoost = not _G.fpsBoost
    toggleBtn(b, s, _G.fpsBoost, "FPS BOOST")
    if _G.fpsBoost then
        Lighting.GlobalShadows = false
        Lighting.FogEnd = 9e9
        settings().Rendering.QualityLevel = 1
        for _, v in pairs(workspace:GetDescendants()) do
            if v:IsA("Part") or v:IsA("MeshPart") then
                v.Material = Enum.Material.SmoothPlastic
                v.CastShadow = false
            elseif v:IsA("Decal") or v:IsA("Texture") then
                v.Transparency = 1
            end
        end
    else
        Lighting.GlobalShadows = true
        settings().Rendering.QualityLevel = Enum.QualityLevel.Automatic
    end
end)

-- [ أنيميشن الفتح ] --
local isOpen = false
OpenBtn.MouseButton1Click:Connect(function()
    isOpen = not isOpen
    if isOpen then
        MainFrame.Visible = true
        OpenBtn.Text = "X"
        MainFrame:TweenPosition(UDim2.new(1, -340, 1, -280), "Out", "Back", 0.5, true)
    else
        OpenBtn.Text = "</>"
        MainFrame:TweenPosition(UDim2.new(1, 400, 1, -280), "In", "Quad", 0.4, true, function() if not isOpen then MainFrame.Visible = false end end)
    end
end)

-- [ نظام السحب ] --
local dragI, dStartI, sPosI
OpenBtn.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragI = true; dStartI = i.Position; sPosI = OpenBtn.Position end end)
UIS.InputChanged:Connect(function(i) if dragI and i.UserInputType == Enum.UserInputType.MouseMovement then
    local delta = i.Position - dStartI
    OpenBtn.Position = UDim2.new(sPosI.X.Scale, sPosI.X.Offset + delta.X, sPosI.Y.Scale, sPosI.Y.Offset + delta.Y)
end end)
UIS.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then dragI = false end end)

-- الحفاظ على دوران الـ Gradient
local UIStrokeGrad = MainFrame.UIStroke.UIGradient
RunService.RenderStepped:Connect(function()
    UIStrokeGrad.Rotation = UIStrokeGrad.Rotation + 2
end)
